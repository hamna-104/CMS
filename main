<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student CGPA Portal</title>
  <!-- Tailwind via CDN (Play CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small helpers */
    .fixed-footer { position: fixed; bottom: 0; left: 0; right: 0; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
  <main class="max-w-4xl mx-auto p-6">
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-2xl font-bold">Student CGPA Portal</h1>
      <div class="text-sm text-slate-500">Runs completely in your browser • Data saved in localStorage</div>
    </header>

    <section id="auth" class="grid md:grid-cols-2 gap-6">
      <div class="p-4 bg-white rounded-lg shadow">
        <h2 class="font-semibold mb-3">Register</h2>
        <label class="block text-sm mb-1">Full name</label>
        <input id="regName" class="w-full p-2 border rounded mb-3" placeholder="e.g. Ali Khan" />
        <label class="block text-sm mb-1">Roll number</label>
        <input id="regRoll" class="w-full p-2 border rounded mb-3" placeholder="e.g. CS-123" />
        <button id="btnRegister" class="px-4 py-2 bg-blue-600 text-white rounded">Register</button>
      </div>

      <div class="p-4 bg-white rounded-lg shadow">
        <h2 class="font-semibold mb-3">Login</h2>
        <label class="block text-sm mb-1">Roll number</label>
        <input id="loginRoll" class="w-full p-2 border rounded mb-3" placeholder="Enter roll to login" />
        <div class="flex gap-2">
          <button id="btnLogin" class="px-4 py-2 bg-green-600 text-white rounded">Login</button>
          <button id="btnDemo" class="px-4 py-2 border rounded">Use Demo</button>
        </div>

        <hr class="my-4" />
        <h3 class="font-semibold mb-2">Import / Export</h3>
        <div class="flex gap-2 items-start">
          <button id="btnExport" class="px-3 py-2 border rounded">Export JSON</button>
          <button id="btnImportOpen" class="px-3 py-2 border rounded">Import JSON</button>
        </div>
        <textarea id="importArea" class="w-full mt-3 p-2 border rounded hidden" rows="6" placeholder='Paste JSON array of students here'></textarea>
        <div id="importActions" class="mt-2 hidden">
          <button id="btnImport" class="px-3 py-2 border rounded">Import</button>
          <button id="btnImportCancel" class="px-3 py-2 border rounded">Cancel</button>
        </div>
      </div>
    </section>

    <section id="app" class="hidden mt-6">
      <div class="p-4 bg-white rounded-lg shadow mb-4 flex items-center justify-between">
        <div>
          <div id="studentName" class="font-semibold text-lg"></div>
          <div id="studentRoll" class="text-sm text-slate-500"></div>
        </div>
        <div class="flex gap-2">
          <button id="btnSave" class="px-3 py-2 border rounded">Save</button>
          <button id="btnLogout" class="px-3 py-2 rounded bg-gray-200">Logout</button>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Add course -->
        <div class="p-4 bg-white rounded-lg shadow">
          <h3 class="font-semibold mb-3">Add / Edit Course</h3>
          <label class="block text-sm mb-1">Course name</label>
          <input id="courseName" class="w-full p-2 border rounded mb-2" />

          <label class="block text-sm mb-1">Credits</label>
          <input id="courseCredits" type="number" min="0" value="3" class="w-full p-2 border rounded mb-2" />

          <div class="mb-2">
            <label class="block text-sm mb-1">Input method</label>
            <div class="flex gap-3 items-center">
              <label class="flex items-center gap-2"><input type="radio" name="inputMethod" value="marks" checked /> Marks (0-100)</label>
              <label class="flex items-center gap-2"><input type="radio" name="inputMethod" value="gp" /> Grade point (0-4)</label>
            </div>
          </div>

          <div id="marksArea" class="mb-2">
            <label class="block text-sm mb-1">Marks</label>
            <input id="courseMarks" type="number" min="0" max="100" class="w-full p-2 border rounded" />
          </div>
          <div id="gpArea" class="mb-2 hidden">
            <label class="block text-sm mb-1">Grade point</label>
            <input id="courseGP" type="number" step="0.01" min="0" max="4" class="w-full p-2 border rounded" />
          </div>

          <div class="flex gap-2 mt-3">
            <button id="btnAddCourse" class="px-4 py-2 bg-indigo-600 text-white rounded">Add Course</button>
            <button id="btnResetCourse" class="px-4 py-2 border rounded">Reset</button>
          </div>

          <div class="mt-3 text-xs text-slate-500">Conversion used (marks → grade point): 90-100→4.0, 85-89→3.7, 80-84→3.3, 75-79→3.0, 70-74→2.7, 65-69→2.3, 60-64→2.0, 55-59→1.7, 50-54→1.3, 45-49→1.0, else 0</div>
        </div>

        <!-- Courses & Result -->
        <div class="p-4 bg-white rounded-lg shadow">
          <h3 class="font-semibold mb-3">Courses</h3>
          <div class="overflow-auto max-h-56">
            <table class="w-full text-sm" id="coursesTable">
              <thead>
                <tr class="text-left text-slate-600">
                  <th class="p-2">Course</th>
                  <th class="p-2">Credits</th>
                  <th class="p-2">Marks</th>
                  <th class="p-2">GP</th>
                  <th class="p-2">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="mt-4 p-3 bg-slate-50 rounded">
            <div class="flex justify-between">
              <div>
                <div class="text-sm text-slate-500">Total credits</div>
                <div id="totalCredits" class="text-xl font-semibold">0</div>
              </div>
              <div>
                <div class="text-sm text-slate-500">Total points</div>
                <div id="totalPoints" class="text-xl font-semibold">0</div>
              </div>
              <div>
                <div class="text-sm text-slate-500">CGPA</div>
                <div id="cgpaValue" class="text-2xl font-bold">0.000</div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="mt-6 p-4 bg-white rounded-lg shadow">
        <h3 class="font-semibold mb-3">All saved students</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm" id="studentsTable">
            <thead>
              <tr class="text-left text-slate-600">
                <th class="p-2">Name</th>
                <th class="p-2">Roll</th>
                <th class="p-2">CGPA</th>
                <th class="p-2">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="mt-4 flex gap-2">
          <button id="btnClearAll" class="px-3 py-2 border rounded">Clear all</button>
          <button id="btnExportAll" class="px-3 py-2 border rounded">Export all</button>
        </div>
      </div>
    </section>

    <footer class="mt-8 text-sm text-slate-500">Tip: This single-file site can be uploaded to GitHub and published with GitHub Pages (choose branch <code>main</code> or <code>gh-pages</code>).</footer>
  </main>

  <script>
    // Single-file CGPA portal logic
    (function(){
      // storage key
      const KEY = 'students_cgpa_portal_v1';

      // DOM refs
      const el = id=> document.getElementById(id);
      const q = sel => document.querySelector(sel);

      const authSection = q('#auth');
      const appSection = q('#app');
      const studentName = el('studentName');
      const studentRoll = el('studentRoll');

      const regName = el('regName');
      const regRoll = el('regRoll');
      const btnRegister = el('btnRegister');
      const btnLogin = el('btnLogin');
      const btnDemo = el('btnDemo');
      const loginRoll = el('loginRoll');

      const btnExport = el('btnExport');
      const btnImportOpen = el('btnImportOpen');
      const importArea = el('importArea');
      const importActions = el('importActions');
      const btnImport = el('btnImport');
      const btnImportCancel = el('btnImportCancel');

      const btnSave = el('btnSave');
      const btnLogout = el('btnLogout');

      const courseName = el('courseName');
      const courseCredits = el('courseCredits');
      const courseMarks = el('courseMarks');
      const courseGP = el('courseGP');
      const btnAddCourse = el('btnAddCourse');
      const btnResetCourse = el('btnResetCourse');

      const marksArea = el('marksArea');
      const gpArea = el('gpArea');

      const coursesTableBody = q('#coursesTable tbody');
      const totalCredits = el('totalCredits');
      const totalPoints = el('totalPoints');
      const cgpaValue = el('cgpaValue');

      const studentsTableBody = q('#studentsTable tbody');
      const btnClearAll = el('btnClearAll');
      const btnExportAll = el('btnExportAll');

      // state
      let students = loadStudents(); // array
      let current = null; // {name, roll, courses: []}
      let editingCourseId = null;

      // helpers
      function saveStudents(){ localStorage.setItem(KEY, JSON.stringify(students)); }
      function loadStudents(){ try{ return JSON.parse(localStorage.getItem(KEY)) || []; }catch(e){ return []; } }

      function marksToGP(m){ const mm = Number(m); if (isNaN(mm)) return 0; if(mm>=90) return 4.0; if(mm>=85) return 3.7; if(mm>=80) return 3.3; if(mm>=75) return 3.0; if(mm>=70) return 2.7; if(mm>=65) return 2.3; if(mm>=60) return 2.0; if(mm>=55) return 1.7; if(mm>=50) return 1.3; if(mm>=45) return 1.0; return 0.0; }

      function calc(courses){ let tc=0,tp=0; for(const c of (courses||[])){ tc+=Number(c.credits||0); tp+= (Number(c.gradePoint||0) * Number(c.credits||0)); } const cgpa = tc===0?0: +(tp/tc).toFixed(3); return { tc, tp: +tp.toFixed(3), cgpa }; }

      function renderStudentsTable(){ studentsTableBody.innerHTML=''; for(const s of students){ const { cgpa } = calc(s.courses||[]); const tr = document.createElement('tr'); tr.className='border-t'; tr.innerHTML=`
        <td class="p-2">${escapeHtml(s.name)}</td>
        <td class="p-2">${escapeHtml(s.roll)}</td>
        <td class="p-2">${cgpa}</td>
        <td class="p-2 flex gap-2">
          <button data-open="${s.roll}" class="px-2 py-1 border rounded openBtn">Open</button>
          <button data-del="${s.roll}" class="px-2 py-1 border rounded delBtn">Delete</button>
        </td>
      `; studentsTableBody.appendChild(tr); }

        // attach actions
        studentsTableBody.querySelectorAll('.openBtn').forEach(b=> b.addEventListener('click', ()=> loginByRoll(b.dataset.open)));
        studentsTableBody.querySelectorAll('.delBtn').forEach(b=> b.addEventListener('click', ()=>{ if(!confirm('Delete this student?')) return; students = students.filter(x=> x.roll !== b.dataset.del); saveStudents(); renderStudentsTable(); logout(); }));
      }

      function renderCourses(){ coursesTableBody.innerHTML = ''; if(!current || !current.courses || current.courses.length===0){ coursesTableBody.innerHTML = '<tr><td class="p-2 text-slate-500" colspan="5">No courses added yet.</td></tr>'; return; }
        for(const c of current.courses){ const tr = document.createElement('tr'); tr.className='border-t'; tr.innerHTML = `
          <td class="p-2">${escapeHtml(c.name)}</td>
          <td class="p-2">${c.credits}</td>
          <td class="p-2">${c.marks===undefined? '-': c.marks}</td>
          <td class="p-2">${c.gradePoint}</td>
          <td class="p-2 flex gap-2">
            <button data-edit="${c.id}" class="px-2 py-1 border rounded editBtn">Edit</button>
            <button data-del="${c.id}" class="px-2 py-1 border rounded delCBtn">Delete</button>
          </td>
        `; coursesTableBody.appendChild(tr); }

        // actions
        coursesTableBody.querySelectorAll('.editBtn').forEach(b=> b.addEventListener('click', ()=> editCourse(b.dataset.edit)));
        coursesTableBody.querySelectorAll('.delCBtn').forEach(b=> b.addEventListener('click', ()=> { if(!confirm('Delete this course?')) return; current.courses = current.courses.filter(cc=> cc.id !== b.dataset.del); syncCurrentToStore(); renderCourses(); renderResult(); }));
      }

      function renderResult(){ const r = calc(current.courses||[]); totalCredits.textContent = r.tc; totalPoints.textContent = r.tp; cgpaValue.textContent = r.cgpa.toFixed(3); }

      function syncCurrentToStore(){ // merge
        students = students.filter(s=> s.roll !== current.roll).concat([current]); saveStudents(); renderStudentsTable(); }

      function loginByRoll(roll){ const s = students.find(x=> x.roll === roll); if(!s) { alert('No student with this roll'); return; } current = JSON.parse(JSON.stringify(s)); showApp(); }

      function showApp(){ authSection.classList.add('hidden'); appSection.classList.remove('hidden'); studentName.textContent = current.name; studentRoll.textContent = 'Roll: ' + current.roll; renderCourses(); renderResult(); renderStudentsTable(); }

      function logout(){ current = null; editingCourseId = null; authSection.classList.remove('hidden'); appSection.classList.add('hidden'); clearCourseForm(); }

      function clearCourseForm(){ courseName.value=''; courseCredits.value = 3; courseMarks.value=''; courseGP.value=''; editingCourseId = null; }

      function editCourse(id){ const c = current.courses.find(cc=> cc.id === id); if(!c) return; editingCourseId = id; courseName.value = c.name; courseCredits.value = c.credits; if(c.marks !== undefined){ document.querySelector('input[name="inputMethod"][value="marks"]').checked = true; marksArea.classList.remove('hidden'); gpArea.classList.add('hidden'); courseMarks.value = c.marks; } else { document.querySelector('input[name="inputMethod"][value="gp"]').checked = true; marksArea.classList.add('hidden'); gpArea.classList.remove('hidden'); courseGP.value = c.gradePoint; } }

      function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; }); }

      // events
      btnRegister.addEventListener('click', ()=>{
        const name = regName.value.trim(); const roll = regRoll.value.trim(); if(!name||!roll) return alert('Provide name and roll'); if(students.some(s=> s.roll === roll)) return alert('Roll already registered — login instead'); const s = { name, roll, courses: [], createdAt: new Date().toISOString() }; students.push(s); saveStudents(); loginByRoll(roll);
      });

      btnLogin.addEventListener('click', ()=>{ const roll = loginRoll.value.trim(); if(!roll) return alert('Enter roll'); loginByRoll(roll); });
      btnDemo.addEventListener('click', ()=>{
        if(students.length>0){ loginByRoll(students[0].roll); return; }
        const s = { name: 'Demo Student', roll: 'DEMO-001', courses: [ { id: 'c1', name: 'Intro to CS', credits: 3, marks: 88, gradePoint: marksToGP(88) }, { id: 'c2', name: 'Calculus', credits: 4, marks: 76, gradePoint: marksToGP(76) } ], createdAt: new Date().toISOString() };
        students.push(s); saveStudents(); loginByRoll(s.roll);
      });

      // import/export
      btnExport.addEventListener('click', ()=>{ const data = JSON.stringify(students, null, 2); const blob = new Blob([data], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'students-cgpa.json'; a.click(); URL.revokeObjectURL(url); });

      btnImportOpen.addEventListener('click', ()=>{ importArea.classList.toggle('hidden'); importActions.classList.toggle('hidden'); });
      btnImportCancel.addEventListener('click', ()=>{ importArea.value=''; importArea.classList.add('hidden'); importActions.classList.add('hidden'); });
      btnImport.addEventListener('click', ()=>{
        try{ const data = JSON.parse(importArea.value); if(!Array.isArray(data)) throw new Error('Expecting array'); // merge by roll, overwrite
          const merged = students.filter(s=> !data.some(d=> d.roll === s.roll)).concat(data);
          students = merged; saveStudents(); renderStudentsTable(); alert('Imported successfully'); importArea.value=''; importArea.classList.add('hidden'); importActions.classList.add('hidden');
        }catch(e){ alert('Invalid JSON: ' + e.message); }
      });

      // course input method switch
      document.querySelectorAll('input[name="inputMethod"]').forEach(r=> r.addEventListener('change', ()=>{
        if(document.querySelector('input[name="inputMethod"][value="marks"]').checked){ marksArea.classList.remove('hidden'); gpArea.classList.add('hidden'); } else { marksArea.classList.add('hidden'); gpArea.classList.remove('hidden'); }
      }));

      btnAddCourse.addEventListener('click', ()=>{
        if(!current) return alert('Login first'); const name = courseName.value.trim(); const credits = Number(courseCredits.value) || 0; if(!name) return alert('Course name required'); let gp, marksVal;
        if(document.querySelector('input[name="inputMethod"][value="marks"]').checked){ marksVal = courseMarks.value === '' ? undefined : Number(courseMarks.value); gp = marksVal===undefined? 0 : marksToGP(marksVal); }
        else { gp = Number(courseGP.value) || 0; }
        const course = { id: editingCourseId || (Date.now().toString()), name, credits, gradePoint: +gp.toFixed(2) };
        if(marksVal !== undefined) course.marks = marksVal;
        if(editingCourseId){ current.courses = current.courses.map(c=> c.id === editingCourseId ? course : c); editingCourseId = null; }
        else { current.courses = current.courses || []; current.courses.push(course); }
        syncCurrentToStore(); renderCourses(); renderResult(); clearCourseForm();
      });

      btnResetCourse.addEventListener('click', ()=> clearCourseForm());

      btnSave.addEventListener('click', ()=>{ if(!current) return; syncCurrentToStore(); alert('Saved'); });
      btnLogout.addEventListener('click', ()=> logout());

      btnClearAll.addEventListener('click', ()=>{ if(!confirm('Clear ALL saved students from localStorage?')) return; students = []; saveStudents(); renderStudentsTable(); logout(); });
      btnExportAll.addEventListener('click', ()=>{ const data = JSON.stringify(students, null, 2); const blob = new Blob([data], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'students-cgpa-all.json'; a.click(); URL.revokeObjectURL(url); });

      // initial render
      renderStudentsTable();

      // on page load, if there's at least one saved student, show demo/login hint
      // keep app hidden until login/register

    })();
  </script>
</body>
</html>
